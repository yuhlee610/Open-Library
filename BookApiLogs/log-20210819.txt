2021-08-19 09:46:07.929 +07:00 [INF] Application is Starting
2021-08-19 09:46:11.132 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 09:46:11.699 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 09:46:11.699 +07:00 [INF] Hosting environment: Development
2021-08-19 09:46:11.699 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 09:46:11.776 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 09:46:11.986 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 212.9990ms
2021-08-19 09:46:12.905 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 09:46:13.145 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 240.5194ms
2021-08-19 09:46:52.244 +07:00 [INF] Request starting HTTP/2 POST https://localhost:44348/api/Account/Login application/json 48
2021-08-19 09:46:52.252 +07:00 [INF] CORS policy execution successful.
2021-08-19 09:46:52.309 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 09:46:52.364 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 09:46:53.196 +07:00 [INF] Login attempt for user@example.com
2021-08-19 09:46:54.515 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 09:46:56.071 +07:00 [INF] Executed DbCommand (95ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 09:46:56.694 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.Threading.Tasks.Task`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 09:46:56.705 +07:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 09:46:57.047 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 4676.1244ms
2021-08-19 09:46:57.048 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 09:46:57.055 +07:00 [INF] Request finished HTTP/2 POST https://localhost:44348/api/Account/Login application/json 48 - 200 - application/json;+charset=utf-8 4813.6098ms
2021-08-19 09:47:49.540 +07:00 [INF] Application is Starting
2021-08-19 09:47:50.918 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 09:47:51.316 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 09:47:51.316 +07:00 [INF] Hosting environment: Development
2021-08-19 09:47:51.316 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 09:47:51.378 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 09:47:51.604 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 228.0179ms
2021-08-19 09:47:51.958 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 09:47:52.160 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 202.1068ms
2021-08-19 09:48:02.862 +07:00 [INF] Request starting HTTP/2 POST https://localhost:44348/api/Account/Login application/json 48
2021-08-19 09:48:02.869 +07:00 [INF] CORS policy execution successful.
2021-08-19 09:48:02.922 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 09:48:02.966 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 09:48:03.437 +07:00 [INF] Login attempt for user@example.com
2021-08-19 09:48:04.665 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 09:48:06.312 +07:00 [INF] Executed DbCommand (124ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 09:48:06.672 +07:00 [INF] Executed DbCommand (68ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 09:48:06.850 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 09:48:06.872 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 3898.2728ms
2021-08-19 09:48:06.874 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 09:48:06.885 +07:00 [INF] Request finished HTTP/2 POST https://localhost:44348/api/Account/Login application/json 48 - 200 - application/json;+charset=utf-8 4022.6067ms
2021-08-19 09:49:38.135 +07:00 [INF] Request starting HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60
2021-08-19 09:49:38.149 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 09:49:38.151 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 09:49:38.174 +07:00 [INF] Login attempt for user@example.com
2021-08-19 09:49:38.204 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 09:49:38.226 +07:00 [INF] Executed DbCommand (12ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 09:49:38.246 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 09:49:38.247 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 09:49:38.248 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 96.5689ms
2021-08-19 09:49:38.248 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 09:49:38.248 +07:00 [INF] Request finished HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60 - 200 - application/json;+charset=utf-8 114.0434ms
2021-08-19 10:34:03.431 +07:00 [INF] Application is Starting
2021-08-19 10:34:04.731 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 10:34:05.072 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 10:34:05.072 +07:00 [INF] Hosting environment: Development
2021-08-19 10:34:05.072 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 10:34:05.114 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 10:34:05.246 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 132.5237ms
2021-08-19 10:34:05.446 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 10:34:05.554 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 107.8487ms
2021-08-19 10:37:48.731 +07:00 [INF] Request starting HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60
2021-08-19 10:37:48.789 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 10:37:48.838 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 10:37:49.257 +07:00 [INF] Login attempt for user@example.com
2021-08-19 10:37:50.024 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 10:37:50.792 +07:00 [INF] Executed DbCommand (50ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 10:37:51.013 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 10:37:51.187 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 10:37:51.199 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 2356.4926ms
2021-08-19 10:37:51.201 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 10:37:51.208 +07:00 [INF] Request finished HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60 - 200 - application/json;+charset=utf-8 2478.8548ms
2021-08-19 10:53:14.081 +07:00 [INF] Application is Starting
2021-08-19 10:53:15.175 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 10:53:15.424 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 10:53:15.424 +07:00 [INF] Hosting environment: Development
2021-08-19 10:53:15.424 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 10:53:15.460 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 10:53:15.569 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 110.3651ms
2021-08-19 10:53:15.771 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 10:53:15.874 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 103.0079ms
2021-08-19 10:55:28.276 +07:00 [INF] Application is Starting
2021-08-19 10:55:29.219 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 10:55:29.520 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 10:55:29.520 +07:00 [INF] Hosting environment: Development
2021-08-19 10:55:29.520 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 10:55:29.560 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 10:55:29.687 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 127.5806ms
2021-08-19 10:55:29.914 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 10:55:30.080 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 165.8614ms
2021-08-19 10:55:34.472 +07:00 [INF] Request starting HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60
2021-08-19 10:55:34.503 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 10:55:34.534 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 10:55:34.844 +07:00 [INF] Login attempt for user@example.com
2021-08-19 10:55:35.532 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 10:55:36.190 +07:00 [INF] Executed DbCommand (47ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 10:55:36.380 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 10:55:36.516 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 10:55:36.527 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 1988.6741ms
2021-08-19 10:55:36.528 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 10:55:36.534 +07:00 [INF] Request finished HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60 - 200 - application/json;+charset=utf-8 2061.9041ms
2021-08-19 10:57:14.371 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Account/Register application/json 72
2021-08-19 10:57:14.377 +07:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2021-08-19 10:57:14.385 +07:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2021-08-19 10:57:14.391 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Account/Register application/json 72 - 405 - - 19.9417ms
2021-08-19 10:57:41.308 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72
2021-08-19 10:57:41.310 +07:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2021-08-19 10:57:41.310 +07:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2021-08-19 10:57:41.312 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72 - 405 - - 6.3365ms
2021-08-19 10:58:20.293 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book application/json 72
2021-08-19 10:58:20.294 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 10:58:20.307 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 10:58:34.066 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 10:58:34.112 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
FROM [Books] AS [b]
WHERE [b].[Id] = @__borrowInfo_IdBook_0
2021-08-19 10:58:34.870 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 11:05:20.328 +07:00 [INF] Application is Starting
2021-08-19 11:05:21.319 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 11:05:21.580 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 11:05:21.580 +07:00 [INF] Hosting environment: Development
2021-08-19 11:05:21.580 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 11:05:21.617 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 11:05:21.729 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 113.1156ms
2021-08-19 11:05:21.924 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 11:05:22.051 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 126.1372ms
2021-08-19 11:05:22.540 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book application/json 72
2021-08-19 11:05:22.580 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 11:05:22.618 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 11:05:31.002 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 11:05:31.684 +07:00 [INF] Executed DbCommand (44ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
FROM [Books] AS [b]
WHERE [b].[Id] = @__borrowInfo_IdBook_0
2021-08-19 11:05:36.272 +07:00 [INF] Executed DbCommand (25ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 13:36:55.838 +07:00 [INF] Application is Starting
2021-08-19 13:36:57.808 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 13:36:58.327 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 13:36:58.327 +07:00 [INF] Hosting environment: Development
2021-08-19 13:36:58.327 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 13:36:58.417 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 13:36:58.936 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 522.7781ms
2021-08-19 13:36:59.305 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 13:36:59.537 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 231.8391ms
2021-08-19 13:37:22.925 +07:00 [INF] Request starting HTTP/2 POST https://localhost:44348/api/Account/Login application/json 48
2021-08-19 13:37:22.933 +07:00 [INF] CORS policy execution successful.
2021-08-19 13:37:22.967 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 13:37:23.003 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 13:37:23.371 +07:00 [INF] Login attempt for user@example.com
2021-08-19 13:37:24.077 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:37:24.807 +07:00 [INF] Executed DbCommand (51ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 13:37:25.029 +07:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 13:37:25.169 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 13:37:25.186 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 2178.3623ms
2021-08-19 13:37:25.187 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 13:37:25.192 +07:00 [INF] Request finished HTTP/2 POST https://localhost:44348/api/Account/Login application/json 48 - 200 - application/json;+charset=utf-8 2267.6527ms
2021-08-19 13:38:17.836 +07:00 [INF] Request starting HTTP/2 PUT https://localhost:44348/api/Book application/json 60
2021-08-19 13:38:17.841 +07:00 [INF] CORS policy execution successful.
2021-08-19 13:38:17.843 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:38:17.858 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 13:38:22.104 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:38:22.181 +07:00 [INF] Executed DbCommand (54ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
FROM [Books] AS [b]
WHERE [b].[Id] = @__borrowInfo_IdBook_0
2021-08-19 13:38:22.772 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 13:38:26.344 +07:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [BookUser] ([BooksId], [UsersId])
VALUES (@p0, @p1);
2021-08-19 13:38:26.361 +07:00 [INF] Executed DbCommand (10ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = -1) (DbType = Binary), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Books] SET [Author] = @p0, [CategoryId] = @p1, [Description] = @p2, [Name] = @p3, [Picture] = @p4, [Year] = @p5
WHERE [Id] = @p6;
SELECT @@ROWCOUNT;
2021-08-19 13:38:26.378 +07:00 [INF] Executing HttpStatusCodeResult, setting HTTP status code 200
2021-08-19 13:38:26.378 +07:00 [INF] Executed action BookApi.Controllers.BookController.BorrowBook (BookApi) in 8520.2807ms
2021-08-19 13:38:26.379 +07:00 [INF] Executed endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:38:26.380 +07:00 [INF] Request finished HTTP/2 PUT https://localhost:44348/api/Book application/json 60 - 200 - - 8544.3066ms
2021-08-19 13:38:46.586 +07:00 [INF] Request starting HTTP/2 PUT https://localhost:44348/api/Book application/json 60
2021-08-19 13:38:46.587 +07:00 [INF] CORS policy execution successful.
2021-08-19 13:38:46.588 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:38:46.588 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 13:38:50.301 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:38:50.312 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
FROM [Books] AS [b]
WHERE [b].[Id] = @__borrowInfo_IdBook_0
2021-08-19 13:38:50.851 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 13:38:54.111 +07:00 [ERR] Failed executing DbCommand (28ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [BookUser] ([BooksId], [UsersId])
VALUES (@p0, @p1);
2021-08-19 13:38:54.188 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'BookApi.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_BookUser'. Cannot insert duplicate key in object 'dbo.BookUser'. The duplicate key value is (1, 9487c2f9-7202-457d-bdcf-92616d7c9e6a).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__169_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__277_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:787be67e-ca66-43e5-a8f2-ea74423f4d38
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(DbContext _, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_BookUser'. Cannot insert duplicate key in object 'dbo.BookUser'. The duplicate key value is (1, 9487c2f9-7202-457d-bdcf-92616d7c9e6a).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__169_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__277_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:787be67e-ca66-43e5-a8f2-ea74423f4d38
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(DbContext _, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2021-08-19 13:47:26.038 +07:00 [INF] Application is Starting
2021-08-19 13:47:26.958 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 13:47:27.217 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 13:47:27.217 +07:00 [INF] Hosting environment: Development
2021-08-19 13:47:27.217 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 13:47:27.249 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 13:47:27.354 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 107.0740ms
2021-08-19 13:47:27.595 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 13:47:27.733 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 137.9845ms
2021-08-19 13:47:47.382 +07:00 [INF] Request starting HTTP/2 PUT https://localhost:44348/api/Book application/json 60
2021-08-19 13:47:47.389 +07:00 [INF] CORS policy execution successful.
2021-08-19 13:47:47.413 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:47:47.444 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 13:47:48.346 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:47:48.936 +07:00 [INF] Executed DbCommand (50ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
FROM [Books] AS [b]
WHERE [b].[Id] = @__borrowInfo_IdBook_0
2021-08-19 13:47:48.990 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 13:47:49.181 +07:00 [ERR] Failed executing DbCommand (8ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [BookUser] ([BooksId], [UsersId])
VALUES (@p0, @p1);
2021-08-19 13:47:49.222 +07:00 [ERR] An exception occurred in the database while saving changes for context type 'BookApi.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_BookUser'. Cannot insert duplicate key in object 'dbo.BookUser'. The duplicate key value is (1, 9487c2f9-7202-457d-bdcf-92616d7c9e6a).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__169_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__277_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0c349855-3ad2-4742-b954-0b1c2c48c514
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(DbContext _, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_BookUser'. Cannot insert duplicate key in object 'dbo.BookUser'. The duplicate key value is (1, 9487c2f9-7202-457d-bdcf-92616d7c9e6a).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__169_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__277_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0c349855-3ad2-4742-b954-0b1c2c48c514
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(DbContext _, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2021-08-19 13:47:49.347 +07:00 [ERR] Something went wrong in the BorrowBook!!
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_BookUser'. Cannot insert duplicate key in object 'dbo.BookUser'. The duplicate key value is (1, 9487c2f9-7202-457d-bdcf-92616d7c9e6a).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__169_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__277_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:0c349855-3ad2-4742-b954-0b1c2c48c514
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(DbContext _, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at BookApi.Repository.UnitOfWork.Save() in E:\.Net core Practice\Open Library\BookApi\BookApi\Repository\UnitOfWork.cs:line 76
   at BookApi.Controllers.BookController.BorrowBook(BorrowInfo borrowInfo) in E:\.Net core Practice\Open Library\BookApi\BookApi\Controllers\BookController.cs:line 107
2021-08-19 13:47:49.390 +07:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2021-08-19 13:47:49.396 +07:00 [INF] Executed action BookApi.Controllers.BookController.BorrowBook (BookApi) in 1946.6412ms
2021-08-19 13:47:49.396 +07:00 [INF] Executed endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:47:49.402 +07:00 [INF] Request finished HTTP/2 PUT https://localhost:44348/api/Book application/json 60 - 500 - text/plain;+charset=utf-8 2019.3763ms
2021-08-19 13:48:06.635 +07:00 [INF] Request starting HTTP/2 PUT https://localhost:44348/api/Book application/json 60
2021-08-19 13:48:06.635 +07:00 [INF] CORS policy execution successful.
2021-08-19 13:48:06.636 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:48:06.636 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 13:48:06.667 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:48:06.674 +07:00 [INF] Executed DbCommand (3ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
FROM [Books] AS [b]
WHERE [b].[Id] = @__borrowInfo_IdBook_0
2021-08-19 13:48:06.679 +07:00 [INF] Executed DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 13:50:47.641 +07:00 [INF] Application is Starting
2021-08-19 13:50:48.574 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 13:50:48.823 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 13:50:48.823 +07:00 [INF] Hosting environment: Development
2021-08-19 13:50:48.823 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 13:50:48.872 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 13:50:48.986 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 116.9340ms
2021-08-19 13:50:49.187 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 13:50:49.294 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 106.7385ms
2021-08-19 13:51:02.089 +07:00 [INF] Request starting HTTP/2 PUT https://localhost:44348/api/Book application/json 60
2021-08-19 13:51:02.098 +07:00 [INF] CORS policy execution successful.
2021-08-19 13:51:02.129 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:51:02.162 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 13:51:03.138 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:51:03.774 +07:00 [INF] Executed DbCommand (56ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[Author], [t].[CategoryId], [t].[Description], [t].[Name], [t].[Picture], [t].[Year], [t0].[Id], [t0].[AccessFailedCount], [t0].[ConcurrencyStamp], [t0].[Email], [t0].[EmailConfirmed], [t0].[FirstName], [t0].[LastName], [t0].[LockoutEnabled], [t0].[LockoutEnd], [t0].[NormalizedEmail], [t0].[NormalizedUserName], [t0].[PasswordHash], [t0].[PhoneNumber], [t0].[PhoneNumberConfirmed], [t0].[SecurityStamp], [t0].[TwoFactorEnabled], [t0].[UserName], [t0].[BooksId], [t0].[UsersId]
FROM (
    SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
    FROM [Books] AS [b]
    WHERE [b].[Id] = @__borrowInfo_IdBook_0
) AS [t]
LEFT JOIN (
    SELECT [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName], [b0].[BooksId], [b0].[UsersId]
    FROM [BookUser] AS [b0]
    INNER JOIN [AspNetUsers] AS [a] ON [b0].[UsersId] = [a].[Id]
) AS [t0] ON [t].[Id] = [t0].[BooksId]
ORDER BY [t].[Id], [t0].[BooksId], [t0].[UsersId], [t0].[Id]
2021-08-19 13:51:03.854 +07:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 13:51:27.213 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2021-08-19 13:51:27.219 +07:00 [INF] Executed action BookApi.Controllers.BookController.BorrowBook (BookApi) in 25052.7437ms
2021-08-19 13:51:27.219 +07:00 [INF] Executed endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 13:51:27.224 +07:00 [INF] Request finished HTTP/2 PUT https://localhost:44348/api/Book application/json 60 - 400 - text/plain;+charset=utf-8 25134.8737ms
2021-08-19 13:56:30.792 +07:00 [INF] Application is Starting
2021-08-19 13:56:31.732 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 13:56:32.021 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 13:56:32.021 +07:00 [INF] Hosting environment: Development
2021-08-19 13:56:32.021 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 13:56:32.052 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 13:56:32.169 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 116.7930ms
2021-08-19 13:56:32.366 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 13:56:32.502 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 135.9429ms
2021-08-19 13:56:51.108 +07:00 [INF] Request starting HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60
2021-08-19 13:56:51.141 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 13:56:51.171 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 13:56:51.505 +07:00 [INF] Login attempt for user@example.com
2021-08-19 13:56:52.223 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 13:56:52.821 +07:00 [INF] Executed DbCommand (49ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 13:56:53.020 +07:00 [INF] Executed DbCommand (15ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 13:56:53.158 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 13:56:53.171 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 1997.1344ms
2021-08-19 13:56:53.172 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 13:56:53.177 +07:00 [INF] Request finished HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60 - 200 - application/json;+charset=utf-8 2068.4228ms
2021-08-19 13:58:52.151 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook?idUser&idBook application/json 72
2021-08-19 13:58:52.192 +07:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2021-08-19 13:58:52.198 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.HandleAsync(RequestDelegate next, HttpContext context, AuthorizationPolicy policy, PolicyAuthorizationResult authorizeResult)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2021-08-19 13:58:52.243 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook?idUser&idBook application/json 72 - 500 - text/plain 92.2465ms
2021-08-19 13:59:17.805 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook?idUser&idBook application/json 72
2021-08-19 13:59:17.810 +07:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2021-08-19 13:59:17.815 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.HandleAsync(RequestDelegate next, HttpContext context, AuthorizationPolicy policy, PolicyAuthorizationResult authorizeResult)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2021-08-19 13:59:17.817 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook?idUser&idBook application/json 72 - 500 - text/plain 12.9663ms
2021-08-19 14:00:19.073 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72
2021-08-19 14:00:19.075 +07:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2021-08-19 14:00:19.080 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.HandleAsync(RequestDelegate next, HttpContext context, AuthorizationPolicy policy, PolicyAuthorizationResult authorizeResult)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2021-08-19 14:00:19.082 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72 - 500 - text/plain 9.1377ms
2021-08-19 14:02:37.441 +07:00 [INF] Application is Starting
2021-08-19 14:02:38.378 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 14:02:38.617 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 14:02:38.617 +07:00 [INF] Hosting environment: Development
2021-08-19 14:02:38.617 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 14:02:38.653 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 14:02:38.762 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 110.7626ms
2021-08-19 14:02:38.994 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 14:02:39.644 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 649.2607ms
2021-08-19 14:02:48.469 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72
2021-08-19 14:02:48.506 +07:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2021-08-19 14:02:48.511 +07:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.HandleAsync(RequestDelegate next, HttpContext context, AuthorizationPolicy policy, PolicyAuthorizationResult authorizeResult)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2021-08-19 14:02:48.557 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72 - 500 - text/plain 88.4198ms
2021-08-19 14:03:38.083 +07:00 [INF] Application is Starting
2021-08-19 14:03:39.334 +07:00 [INF] User profile is available. Using 'C:\Users\APTS\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2021-08-19 14:03:39.598 +07:00 [INF] Application started. Press Ctrl+C to shut down.
2021-08-19 14:03:39.598 +07:00 [INF] Hosting environment: Development
2021-08-19 14:03:39.598 +07:00 [INF] Content root path: E:\.Net core Practice\Open Library\BookApi\BookApi
2021-08-19 14:03:39.655 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/index.html - -
2021-08-19 14:03:39.655 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72
2021-08-19 14:03:39.980 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/index.html - - - 200 - text/html;charset=utf-8 329.0164ms
2021-08-19 14:03:40.047 +07:00 [INF] Bearer was not authenticated. Failure message: No SecurityTokenValidator available for token.
2021-08-19 14:03:40.051 +07:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2021-08-19 14:03:40.061 +07:00 [INF] AuthenticationScheme: Bearer was challenged.
2021-08-19 14:03:40.063 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72 - 401 - - 412.3264ms
2021-08-19 14:03:40.267 +07:00 [INF] Request starting HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - -
2021-08-19 14:03:40.378 +07:00 [INF] Request finished HTTP/2 GET https://localhost:44348/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 111.3365ms
2021-08-19 14:03:52.818 +07:00 [INF] Request starting HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60
2021-08-19 14:03:52.823 +07:00 [INF] Executing endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 14:03:52.862 +07:00 [INF] Route matched with {action = "Login", controller = "Account"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Login(BookApi.Models.LoginUserDTO) on controller BookApi.Controllers.AccountController (BookApi).
2021-08-19 14:03:53.304 +07:00 [INF] Login attempt for user@example.com
2021-08-19 14:03:54.129 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 14:03:55.709 +07:00 [INF] Executed DbCommand (126ms) [Parameters=[@__normalizedEmail_0='?' (Size = 256)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[NormalizedEmail] = @__normalizedEmail_0
2021-08-19 14:03:55.924 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [a0].[Name]
FROM [AspNetUserRoles] AS [a]
INNER JOIN [AspNetRoles] AS [a0] ON [a].[RoleId] = [a0].[Id]
WHERE [a].[UserId] = @__userId_0
2021-08-19 14:03:56.089 +07:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType0`1[[System.String, System.Private.CoreLib, Version=5.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2021-08-19 14:03:56.101 +07:00 [INF] Executed action BookApi.Controllers.AccountController.Login (BookApi) in 3234.665ms
2021-08-19 14:03:56.103 +07:00 [INF] Executed endpoint 'BookApi.Controllers.AccountController.Login (BookApi)'
2021-08-19 14:03:56.110 +07:00 [INF] Request finished HTTP/1.1 POST https://localhost:44348/api/Account/Login application/json 60 - 200 - application/json;+charset=utf-8 3292.3922ms
2021-08-19 14:04:18.231 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72
2021-08-19 14:04:18.327 +07:00 [INF] Successfully validated the token.
2021-08-19 14:04:18.332 +07:00 [INF] Authorization was successful.
2021-08-19 14:04:18.332 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 14:04:18.335 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 14:04:29.195 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 14:04:29.528 +07:00 [INF] Executed DbCommand (251ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[Author], [t].[CategoryId], [t].[Description], [t].[Name], [t].[Picture], [t].[Year], [t0].[Id], [t0].[AccessFailedCount], [t0].[ConcurrencyStamp], [t0].[Email], [t0].[EmailConfirmed], [t0].[FirstName], [t0].[LastName], [t0].[LockoutEnabled], [t0].[LockoutEnd], [t0].[NormalizedEmail], [t0].[NormalizedUserName], [t0].[PasswordHash], [t0].[PhoneNumber], [t0].[PhoneNumberConfirmed], [t0].[SecurityStamp], [t0].[TwoFactorEnabled], [t0].[UserName], [t0].[BooksId], [t0].[UsersId]
FROM (
    SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
    FROM [Books] AS [b]
    WHERE [b].[Id] = @__borrowInfo_IdBook_0
) AS [t]
LEFT JOIN (
    SELECT [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName], [b0].[BooksId], [b0].[UsersId]
    FROM [BookUser] AS [b0]
    INNER JOIN [AspNetUsers] AS [a] ON [b0].[UsersId] = [a].[Id]
) AS [t0] ON [t].[Id] = [t0].[BooksId]
ORDER BY [t].[Id], [t0].[BooksId], [t0].[UsersId], [t0].[Id]
2021-08-19 14:04:29.615 +07:00 [INF] Executed DbCommand (2ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 14:04:29.616 +07:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2021-08-19 14:04:29.617 +07:00 [INF] Executed action BookApi.Controllers.BookController.BorrowBook (BookApi) in 11281.95ms
2021-08-19 14:04:29.617 +07:00 [INF] Executed endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 14:04:29.618 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72 - 400 - text/plain;+charset=utf-8 11387.0361ms
2021-08-19 14:04:43.298 +07:00 [INF] Request starting HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72
2021-08-19 14:04:43.298 +07:00 [INF] Successfully validated the token.
2021-08-19 14:04:43.299 +07:00 [INF] Authorization was successful.
2021-08-19 14:04:43.299 +07:00 [INF] Executing endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 14:04:43.299 +07:00 [INF] Route matched with {action = "BorrowBook", controller = "Book"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] BorrowBook(BookApi.Models.BorrowInfo) on controller BookApi.Controllers.BookController (BookApi).
2021-08-19 14:04:43.330 +07:00 [INF] Entity Framework Core 5.0.9 initialized 'ApplicationDbContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2021-08-19 14:04:43.616 +07:00 [INF] Executed DbCommand (283ms) [Parameters=[@__borrowInfo_IdBook_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[Id], [t].[Author], [t].[CategoryId], [t].[Description], [t].[Name], [t].[Picture], [t].[Year], [t0].[Id], [t0].[AccessFailedCount], [t0].[ConcurrencyStamp], [t0].[Email], [t0].[EmailConfirmed], [t0].[FirstName], [t0].[LastName], [t0].[LockoutEnabled], [t0].[LockoutEnd], [t0].[NormalizedEmail], [t0].[NormalizedUserName], [t0].[PasswordHash], [t0].[PhoneNumber], [t0].[PhoneNumberConfirmed], [t0].[SecurityStamp], [t0].[TwoFactorEnabled], [t0].[UserName], [t0].[BooksId], [t0].[UsersId]
FROM (
    SELECT TOP(1) [b].[Id], [b].[Author], [b].[CategoryId], [b].[Description], [b].[Name], [b].[Picture], [b].[Year]
    FROM [Books] AS [b]
    WHERE [b].[Id] = @__borrowInfo_IdBook_0
) AS [t]
LEFT JOIN (
    SELECT [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName], [b0].[BooksId], [b0].[UsersId]
    FROM [BookUser] AS [b0]
    INNER JOIN [AspNetUsers] AS [a] ON [b0].[UsersId] = [a].[Id]
) AS [t0] ON [t].[Id] = [t0].[BooksId]
ORDER BY [t].[Id], [t0].[BooksId], [t0].[UsersId], [t0].[Id]
2021-08-19 14:04:43.834 +07:00 [INF] Executed DbCommand (14ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Id], [a].[AccessFailedCount], [a].[ConcurrencyStamp], [a].[Email], [a].[EmailConfirmed], [a].[FirstName], [a].[LastName], [a].[LockoutEnabled], [a].[LockoutEnd], [a].[NormalizedEmail], [a].[NormalizedUserName], [a].[PasswordHash], [a].[PhoneNumber], [a].[PhoneNumberConfirmed], [a].[SecurityStamp], [a].[TwoFactorEnabled], [a].[UserName]
FROM [AspNetUsers] AS [a]
WHERE [a].[Id] = @__p_0
2021-08-19 14:04:44.022 +07:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [BookUser] ([BooksId], [UsersId])
VALUES (@p0, @p1);
2021-08-19 14:04:44.594 +07:00 [INF] Executed DbCommand (564ms) [Parameters=[@p6='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = -1) (DbType = Binary), @p5='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Books] SET [Author] = @p0, [CategoryId] = @p1, [Description] = @p2, [Name] = @p3, [Picture] = @p4, [Year] = @p5
WHERE [Id] = @p6;
SELECT @@ROWCOUNT;
2021-08-19 14:04:44.626 +07:00 [INF] Executing HttpStatusCodeResult, setting HTTP status code 200
2021-08-19 14:04:44.626 +07:00 [INF] Executed action BookApi.Controllers.BookController.BorrowBook (BookApi) in 1326.9101ms
2021-08-19 14:04:44.626 +07:00 [INF] Executed endpoint 'BookApi.Controllers.BookController.BorrowBook (BookApi)'
2021-08-19 14:04:44.627 +07:00 [INF] Request finished HTTP/1.1 PUT https://localhost:44348/api/Book/BorrowBook application/json 72 - 200 - - 1328.9242ms
